
#include <Wire.h>
#define mpu_add 0x68

long ac_x, ac_y, ac_z, gy_x, gy_y, gy_z ;

double angle = 0, deg ;
double dgy_x ; 


void setup() {// put your setup code here, to run once:
  Serial.begin(9600) ;
  Wire.begin() ; 
  Wire.beginTransmission(mpu_add) ;
  Wire.write(0x6B) ;
  Wire.write(0) ;
  Wire.endTransmission(true) ;
}


void loop() {// put your main code here, to run repeatedly:
  Wire.beginTransmission(mpu_add) ; 
  Wire.write(0x3B) ;
  Wire.endTransmission(false) ;
  Wire.requestFrom(mpu_add, 6, true) ;

  ac_x = Wire.read() << 8 | Wire.read() ;
  ac_y = Wire.read() << 8 | Wire.read() ;
  ac_z = Wire.read() << 8 | Wire.read() ;

  Wire.beginTransmission(mpu_add) ;
  Wire.write(0x43) ;
  Wire.endTransmission(false) ;
  Wire.requestFrom(mpu_add, 6, true) ;

  gy_x = Wire.read() << 8 | Wire.read() ;
  gy_y = Wire.read() << 8 | Wire.read() ;
  gy_z = Wire.read() << 8 | Wire.read() ;

  deg = atan2(ac_x, ac_z) * 180 / PI ; 
  dgy_x = gy_y / 131. ;

  angle = (0.95 * (angle + (dgy_x * 0.001))) + (0.05 * deg) ;
  Serial.println(angle) ;
}
